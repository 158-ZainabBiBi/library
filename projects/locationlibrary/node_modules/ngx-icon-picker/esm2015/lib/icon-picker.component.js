import { ChangeDetectorRef, Component, ElementRef, ViewChild } from '@angular/core';
import { IconPickerService } from './icon-picker.service';
import { IconType } from './icon';
export class IconPickerComponent {
    constructor(el, cdr, service) {
        this.el = el;
        this.cdr = cdr;
        this.service = service;
        this.iconType = IconType;
        this.icons = [];
        this.search = '';
        this.dialogArrowSize = 10;
    }
    setDialog(instance, elementRef, icon, ipPosition, ipHeight, ipMaxHeight, ipWidth, ipPlaceHolder, ipFallbackIcon, ipIconPack, ipIconSize, ipIconVerticalPadding, ipIconHorizontalPadding, ipButtonStyleClass, ipDivSearchStyleClass, ipInputSearchStyleClass, ipKeepSearchFilter) {
        this.directiveInstance = instance;
        this.setInitialIcon(icon);
        this.directiveElementRef = elementRef;
        this.ipPosition = ipPosition;
        this.ipHeight = parseInt(ipHeight, 10);
        this.ipMaxHeight = parseInt(ipMaxHeight, 10);
        this.ipWidth = parseInt(ipWidth, 10);
        if (!this.ipWidth) {
            this.ipWidth = elementRef.nativeElement.offsetWidth;
        }
        this.ipIconSize = parseInt(ipIconSize, 10);
        this.ipIconVerticalPadding = parseInt(ipIconVerticalPadding, 10);
        this.ipIconHorizontalPadding = parseInt(ipIconHorizontalPadding, 10);
        this.ipKeepSearchFilter = JSON.parse(ipKeepSearchFilter);
        this.ipPlaceHolder = ipPlaceHolder;
        this.ipFallbackIcon = ipFallbackIcon;
        this.ipIconPack = ipIconPack;
        this.ipButtonStyleClass = ipButtonStyleClass;
        this.ipInputSearchStyleClass = ipInputSearchStyleClass;
        this.ipDivSearchStyleClass = ipDivSearchStyleClass;
        this.buttonHeight = this.ipIconSize + 2 * this.ipIconVerticalPadding;
        this.buttonWidth = this.ipIconSize + 2 * this.ipIconHorizontalPadding;
    }
    ngOnInit() {
        this.icons = this.service.getIcons(this.ipIconPack);
        this.listenerMouseDown = (event) => this.onMouseDown(event);
        this.listenerResize = () => this.onResize();
        this.openDialog(this.initialIcon);
    }
    setInitialIcon(icon) {
        this.initialIcon = icon;
        this.selectedIcon = this.icons.find(el => el ?
            `fa fa-${el.id}` === icon || `glyphicon glyphicon-${el.id}` === icon || `${el.id}` === icon :
            false);
        if (this.ipKeepSearchFilter && this.selectedIcon && icon !== this.ipFallbackIcon) {
            this.search = this.selectedIcon.id;
        }
        else {
            this.search = '';
        }
    }
    openDialog(icon) {
        this.setInitialIcon(icon);
        this.openIconPicker();
    }
    setSearch(val) {
        this.search = val;
    }
    selectIcon(icon) {
        if (icon.type === IconType.FontAwesome) {
            this.directiveInstance.iconSelected(`fa fa-${icon.id}`);
        }
        else if (icon.type === IconType.Bootstrap) {
            this.directiveInstance.iconSelected(`glyphicon glyphicon-${icon.id}`);
        }
        else if (icon.type === IconType.FontAwesome5) {
            this.directiveInstance.iconSelected(`${icon.id}`);
        }
        else if (icon.type === IconType.Material) {
            this.directiveInstance.iconSelected(`${icon.id}`);
        }
        this.closeIconPicker();
    }
    onMouseDown(event) {
        if (!this.isDescendant(this.el.nativeElement, event.target) && event.target !== this.directiveElementRef.nativeElement) {
            this.closeIconPicker();
        }
    }
    openIconPicker() {
        if (!this.show) {
            this.show = true;
            this.hidden = true;
            setTimeout(() => {
                this.setDialogPosition();
                this.hidden = false;
                this.cdr.detectChanges();
            }, 0);
            document.addEventListener('mousedown', this.listenerMouseDown);
            window.addEventListener('resize', this.listenerResize);
        }
    }
    closeIconPicker() {
        if (this.show) {
            this.show = false;
            document.removeEventListener('mousedown', this.listenerMouseDown);
            window.removeEventListener('resize', this.listenerResize);
            this.cdr.detectChanges();
        }
    }
    onResize() {
        if (this.position === 'fixed') {
            this.setDialogPosition();
        }
    }
    setDialogPosition() {
        const dialogHeight = this.dialogElement.nativeElement.offsetHeight;
        let node = this.directiveElementRef.nativeElement;
        let position = 'static';
        let transform = '';
        let parentNode = null;
        let transformNode = null;
        let style = null;
        while (node !== null && node.tagName !== 'HTML') {
            style = window.getComputedStyle(node);
            position = style.getPropertyValue('position');
            transform = style.getPropertyValue('transform');
            if (position !== 'static' && parentNode === null) {
                parentNode = node;
            }
            if (transform && transform !== 'none' && transformNode === null) {
                transformNode = node;
            }
            if (position === 'fixed') {
                parentNode = transformNode;
                break;
            }
            node = node.parentNode;
        }
        const boxDirective = this.createBox(this.directiveElementRef.nativeElement, (position !== 'fixed'));
        if (position !== 'fixed' || parentNode) {
            if (parentNode === null) {
                parentNode = node;
            }
            const boxParent = this.createBox(parentNode, true);
            this.top = boxDirective.top - boxParent.top;
            this.left = boxDirective.left - boxParent.left;
        }
        else {
            this.top = boxDirective.top;
            this.left = boxDirective.left;
        }
        if (position === 'fixed') {
            this.position = 'fixed';
        }
        if (this.ipPosition === 'left') {
            this.left -= this.ipWidth + this.dialogArrowSize - 2;
        }
        else if (this.ipPosition === 'top') {
            this.top -= dialogHeight + this.dialogArrowSize;
            this.arrowTop = dialogHeight - 1;
        }
        else if (this.ipPosition === 'bottom') {
            this.top += boxDirective.height + this.dialogArrowSize;
        }
        else {
            this.left += boxDirective.width + this.dialogArrowSize - 2;
        }
    }
    isDescendant(parent, child) {
        let node = child.parentNode;
        while (node !== null) {
            if (node === parent) {
                return true;
            }
            node = node.parentNode;
        }
        return false;
    }
    createBox(element, offset) {
        return {
            top: element.getBoundingClientRect().top + (offset ? window.pageYOffset : 0),
            left: element.getBoundingClientRect().left + (offset ? window.pageXOffset : 0),
            width: element.offsetWidth,
            height: element.offsetHeight
        };
    }
}
IconPickerComponent.decorators = [
    { type: Component, args: [{
                // eslint-disable-next-line @angular-eslint/component-selector
                selector: 'icon-picker',
                template: "<div class=\"icon-picker\" #dialogPopup\r\n     [hidden]=\"!show\"\r\n     [style.visibility]=\"this.hidden ? 'hidden' : 'visible'\"\r\n     [style.height.px]=\"ipHeight\"\r\n     [style.width.px]=\"ipWidth\"\r\n     [style.top.px]=\"top\"\r\n     [style.left.px]=\"left\"\r\n     [style.position]=\"position\">\r\n\r\n  <div class=\"arrow arrow-{{ipPosition}}\" [style.top.px]=\"arrowTop\"></div>\r\n\r\n  <div class=\"icon-search {{ipDivSearchStyleClass}}\">\r\n    <input type=\"text\" class=\"{{ipInputSearchStyleClass}}\" [text] [value]=\"search\" (newValue)=\"setSearch($event)\"\r\n           [placeholder]=\"ipPlaceHolder\">\r\n  </div>\r\n  <div class=\"icon-grid\" [ngStyle]=\"{'max-height.px': ipMaxHeight}\">\r\n    <div *ngFor=\"let icon of icons | searchIcon:search\">\r\n      <button *ngIf=\"icon\" class=\"ip-button-icon {{ipButtonStyleClass}}\" type=\"button\" title=\"{{ icon.name }}\"\r\n              [ngClass]=\"{active : icon === selectedIcon}\"\r\n              [style.width.px]=\"buttonWidth\"\r\n              [style.height.px]=\"buttonHeight\"\r\n              [style.padding-top.px]=\"ipIconVerticalPadding\"\r\n              [style.padding-bottom.px]=\"ipIconVerticalPadding\"\r\n              [style.padding-left.px]=\"ipIconHorizontalPadding\"\r\n              [style.padding-right.px]=\"ipIconHorizontalPadding\"\r\n              (click)=\"selectIcon(icon)\">\r\n        <span *ngIf=\"icon.type === iconType.FontAwesome\" class=\"fa fa-{{icon.id}}\"\r\n              [style.font-size.px]=\"ipIconSize\"></span>\r\n        <span *ngIf=\"icon.type === iconType.Bootstrap\" class=\"glyphicon glyphicon-{{icon.id}}\"\r\n              [style.font-size.px]=\"ipIconSize\"></span>\r\n        <span *ngIf=\"icon.type === iconType.FontAwesome5\" class=\"{{icon.id}}\"\r\n              [style.font-size.px]=\"ipIconSize\"></span>\r\n        <span *ngIf=\"icon.type === iconType.Material\" class=\"material-icons\"\r\n              [style.font-size.px]=\"ipIconSize\">{{icon.id}}</span>\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n",
                styles: [".icon-picker{box-sizing:border-box;margin:0;position:absolute;z-index:100000;top:250px;left:30px;width:230px;height:auto;border:1px solid #777;cursor:default;background-color:#fff;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.icon-picker i{position:relative;cursor:default}.icon-picker .arrow{position:absolute;z-index:999999;width:0;height:0;border-style:solid}.icon-picker .arrow-right{top:10px;left:-20px;border-width:5px 10px;border-color:transparent #777 transparent transparent}.icon-picker .arrow-left{top:10px;left:100%;border-width:5px 10px;border-color:transparent transparent transparent #777}.icon-picker .arrow-bottom{top:-20px;left:10px;border-width:10px 5px;border-color:transparent transparent #777}.icon-picker .arrow-top{left:10px;border-width:10px 5px;border-color:#777 transparent transparent}.icon-picker div.icon-search{padding:5px}.icon-picker div.icon-grid{display:flex;overflow-y:auto;flex-direction:row;flex-wrap:wrap;padding:5px}.icon-picker div.icon-grid div{margin:2px}.icon-picker div.cursor-sv{position:relative;width:15px;height:15px;border-radius:50%;border:1px solid #ddd;cursor:default}.icon-picker div.cursor{position:relative;width:16px;height:16px;border-radius:50%;border:2px solid #222;cursor:default}"]
            },] }
];
IconPickerComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: IconPickerService }
];
IconPickerComponent.propDecorators = {
    dialogElement: [{ type: ViewChild, args: ['dialogPopup',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWNvbi1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbGliL3NyYy9saWIvaWNvbi1waWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFVLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUUxRixPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQU8sUUFBUSxFQUFDLE1BQU0sUUFBUSxDQUFDO0FBU3RDLE1BQU0sT0FBTyxtQkFBbUI7SUE2QzlCLFlBQ1UsRUFBYyxFQUNkLEdBQXNCLEVBQ3RCLE9BQTBCO1FBRjFCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUN0QixZQUFPLEdBQVAsT0FBTyxDQUFtQjtRQW5CN0IsYUFBUSxHQUFHLFFBQVEsQ0FBQztRQUkzQixVQUFLLEdBQVcsRUFBRSxDQUFDO1FBQ25CLFdBQU0sR0FBRyxFQUFFLENBQUM7UUFTSixvQkFBZSxHQUFHLEVBQUUsQ0FBQztJQU03QixDQUFDO0lBRUQsU0FBUyxDQUFDLFFBQWEsRUFBRSxVQUFzQixFQUFFLElBQVksRUFBRSxVQUFrQixFQUFFLFFBQWdCLEVBQUUsV0FBbUIsRUFDOUcsT0FBZSxFQUFFLGFBQXFCLEVBQUUsY0FBc0IsRUFBRSxVQUFvQixFQUFFLFVBQWtCLEVBQ3hHLHFCQUE2QixFQUFFLHVCQUErQixFQUFFLGtCQUEwQixFQUFFLHFCQUE2QixFQUN6SCx1QkFBK0IsRUFBRSxrQkFBMEI7UUFDbkUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLFFBQVEsQ0FBQztRQUNsQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxVQUFVLENBQUM7UUFDdEMs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QUFVO1FBQ2xDLElBQUksSUFBSSxHQUFRLEtBQUssQ0FBQyxVQUFVLENBQUM7UUFDakMsT0FBTyxJQUFJLEtBQUssSUFBSSxFQUFFO1lBQ3BCLElBQUksSUFBSSxLQUFLLE1BQU0sRUFBRTtnQkFDbkIsT0FBTyxJQUFJLENBQUM7YUFDYjtZQUNELElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1NBQ3hCO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsU0FBUyxDQUFDLE9BQVksRUFBRSxNQUFlO1FBQ3JDLE9BQU87WUFDTCxHQUFHLEVBQUUsT0FBTyxDQUFDLHFCQUFxQixFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlFLEtBQUssRUFBRSxPQUFPLENBQUMsV0FBVztZQUMxQixNQUFNLEVBQUUsT0FBTyxDQUFDLFlBQVk7U0FDN0IsQ0FBQztJQUNKLENBQUM7OztZQXpPRixTQUFTLFNBQUM7Z0JBQ1QsOERBQThEO2dCQUM5RCxRQUFRLEVBQUUsYUFBYTtnQkFDdkIsa2lFQUEyQzs7YUFFNUM7OztZQVZxQyxVQUFVO1lBQXhDLGlCQUFpQjtZQUVqQixpQkFBaUI7Ozs0QkFXdEIsU0FBUyxTQUFDLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIE9uSW5pdCwgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7SWNvblBpY2tlclNlcnZpY2V9IGZyb20gJy4vaWNvbi1waWNrZXIuc2VydmljZSc7XHJcbmltcG9ydCB7SWNvbiwgSWNvblR5cGV9IGZyb20gJy4vaWNvbic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1zZWxlY3RvclxyXG4gIHNlbGVjdG9yOiAnaWNvbi1waWNrZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9pY29uLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vaWNvbi1waWNrZXIuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEljb25QaWNrZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIEBWaWV3Q2hpbGQoJ2RpYWxvZ1BvcHVwJykgZGlhbG9nRWxlbWVudDogYW55O1xyXG5cclxuICAvLyBQb3BvdmVyXHJcbiAgcHVibGljIGlwUG9zaXRpb246IHN0cmluZztcclxuICBwdWJsaWMgaXBIZWlnaHQ6IG51bWJlcjtcclxuICBwdWJsaWMgaXBNYXhIZWlnaHQ6IG51bWJlcjtcclxuICBwdWJsaWMgaXBXaWR0aDogbnVtYmVyO1xyXG4gIC8vIEljb24gY3NzXHJcbiAgcHVibGljIGlwSWNvblNpemU6IG51bWJlcjtcclxuICBwdWJsaWMgaXBJY29uVmVydGljYWxQYWRkaW5nOiBudW1iZXI7XHJcbiAgcHVibGljIGlwSWNvbkhvcml6b250YWxQYWRkaW5nOiBudW1iZXI7XHJcbiAgLy8gSXRlbSBTdHlsZSBpZSBpbnB1dCBhbmQgYnV0dG9uXHJcbiAgcHVibGljIGlwQnV0dG9uU3R5bGVDbGFzczogc3RyaW5nO1xyXG4gIHB1YmxpYyBpcElucHV0U2VhcmNoU3R5bGVDbGFzczogc3RyaW5nO1xyXG4gIHB1YmxpYyBpcERpdlNlYXJjaFN0eWxlQ2xhc3M6IHN0cmluZztcclxuICAvLyBJY29uIGFuZCBiZWhhdmlvcnNcclxuICBwdWJsaWMgaXBLZWVwU2VhcmNoRmlsdGVyOiBib29sZWFuO1xyXG4gIHB1YmxpYyBpcFBsYWNlSG9sZGVyOiBzdHJpbmc7XHJcbiAgcHVibGljIGlwRmFsbGJhY2tJY29uOiBzdHJpbmc7XHJcbiAgcHVibGljIGlwSWNvblBhY2s6IHN0cmluZ1tdO1xyXG5cclxuICBwdWJsaWMgc2hvdzogYm9vbGVhbjtcclxuICBwdWJsaWMgaGlkZGVuOiBib29sZWFuO1xyXG4gIHB1YmxpYyB0b3A6IG51bWJlcjtcclxuICBwdWJsaWMgbGVmdDogbnVtYmVyO1xyXG4gIHB1YmxpYyBwb3NpdGlvbjogc3RyaW5nO1xyXG4gIHB1YmxpYyBhcnJvd1RvcDogbnVtYmVyO1xyXG4gIHB1YmxpYyBzZWxlY3RlZEljb246IEljb247XHJcbiAgcHVibGljIGljb25UeXBlID0gSWNvblR5cGU7XHJcbiAgcHVibGljIGJ1dHRvbldpZHRoOiBudW1iZXI7XHJcbiAgcHVibGljIGJ1dHRvbkhlaWdodDogbnVtYmVyO1xyXG5cclxuICBpY29uczogSWNvbltdID0gW107XHJcbiAgc2VhcmNoID0gJyc7XHJcblxyXG4gIHByaXZhdGUgZGlyZWN0aXZlSW5zdGFuY2U6IGFueTtcclxuICBwcml2YXRlIGluaXRpYWxJY29uOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBkaXJlY3RpdmVFbGVtZW50UmVmOiBFbGVtZW50UmVmO1xyXG5cclxuICBwcml2YXRlIGxpc3RlbmVyTW91c2VEb3duOiBhbnk7XHJcbiAgcHJpdmF0ZSBsaXN0ZW5lclJlc2l6ZTogYW55O1xyXG5cclxuICBwcml2YXRlIGRpYWxvZ0Fycm93U2l6ZSA9IDEwO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgICBwcml2YXRlIHNlcnZpY2U6IEljb25QaWNrZXJTZXJ2aWNlKSB7XHJcbiAgfVxyXG5cclxuICBzZXREaWFsb2coaW5zdGFuY2U6IGFueSwgZWxlbWVudFJlZjogRWxlbWVudFJlZiwgaWNvbjogc3RyaW5nLCBpcFBvc2l0aW9uOiBzdHJpbmcsIGlwSGVpZ2h0OiBzdHJpbmcsIGlwTWF4SGVpZ2h0OiBzdHJpbmcsXHJcbiAgICAgICAgICAgIGlwV2lkdGg6IHN0cmluZywgaXBQbGFjZUhvbGRlcjogc3RyaW5nLCBpcEZhbGxiYWNrSWNvbjogc3RyaW5nLCBpcEljb25QYWNrOiBzdHJpbmdbXSwgaXBJY29uU2l6ZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBpcEljb25WZXJ0aWNhbFBhZGRpbmc6IHN0cmluZywgaXBJY29uSG9yaXpvbnRhbFBhZGRpbmc6IHN0cmluZywgaXBCdXR0b25TdHlsZUNsYXNzOiBzdHJpbmcsIGlwRGl2U2VhcmNoU3R5bGVDbGFzczogc3RyaW5nLFxyXG4gICAgICAgICAgICBpcElucHV0U2VhcmNoU3R5bGVDbGFzczogc3RyaW5nLCBpcEtlZXBTZWFyY2hGaWx0ZXI6IHN0cmluZykge1xyXG4gICAgdGhpcy5kaXJlY3RpdmVJbnN0YW5jZSA9IGluc3RhbmNlO1xyXG4gICAgdGhpcy5zZXRJbml0aWFsSWNvbihpY29uKTtcclxuICAgIHRoaXMuZGlyZWN0aXZlRWxlbWVudFJlZiA9IGVsZW1lbnRSZWY7XHJcbiAgICB0aGlzLmlwUG9zaXRpb24gPSBpcFBvc2l0aW9uO1xyXG4gICAgdGhpcy5pcEhlaWdodCA9IHBhcnNlSW50KGlwSGVpZ2h0LCAxMCk7XHJcbiAgICB0aGlzLmlwTWF4SGVpZ2h0ID0gcGFyc2VJbnQoaXBNYXhIZWlnaHQsIDEwKTtcclxuICAgIHRoaXMuaXBXaWR0aCA9IHBhcnNlSW50KGlwV2lkdGgsIDEwKTtcclxuICAgIGlmICghdGhpcy5pcFdpZHRoKSB7XHJcbiAgICAgIHRoaXMuaXBXaWR0aCA9IGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICAgIH1cclxuICAgIHRoaXMuaXBJY29uU2l6ZSA9IHBhcnNlSW50KGlwSWNvblNpemUsIDEwKTtcclxuICAgIHRoaXMuaXBJY29uVmVydGljYWxQYWRkaW5nID0gcGFyc2VJbnQoaXBJY29uVmVydGljYWxQYWRkaW5nLCAxMCk7XHJcbiAgICB0aGlzLmlwSWNvbkhvcml6b250YWxQYWRkaW5nID0gcGFyc2VJbnQoaXBJY29uSG9yaXpvbnRhbFBhZGRpbmcsIDEwKTtcclxuICAgIHRoaXMuaXBLZWVwU2VhcmNoRmlsdGVyID0gSlNPTi5wYXJzZShpcEtlZXBTZWFyY2hGaWx0ZXIpO1xyXG4gICAgdGhpcy5pcFBsYWNlSG9sZGVyID0gaXBQbGFjZUhvbGRlcjtcclxuICAgIHRoaXMuaXBGYWxsYmFja0ljb24gPSBpcEZhbGxiYWNrSWNvbjtcclxuICAgIHRoaXMuaXBJY29uUGFjayA9IGlwSWNvblBhY2s7XHJcbiAgICB0aGlzLmlwQnV0dG9uU3R5bGVDbGFzcyA9IGlwQnV0dG9uU3R5bGVDbGFzcztcclxuICAgIHRoaXMuaXBJbnB1dFNlYXJjaFN0eWxlQ2xhc3MgPSBpcElucHV0U2VhcmNoU3R5bGVDbGFzcztcclxuICAgIHRoaXMuaXBEaXZTZWFyY2hTdHlsZUNsYXNzID0gaXBEaXZTZWFyY2hTdHlsZUNsYXNzO1xyXG5cclxuICAgIHRoaXMuYnV0dG9uSGVpZ2h0ID0gdGhpcy5pcEljb25TaXplICsgMiAqIHRoaXMuaXBJY29uVmVydGljYWxQYWRkaW5nO1xyXG4gICAgdGhpcy5idXR0b25XaWR0aCA9IHRoaXMuaXBJY29uU2l6ZSArIDIgKiB0aGlzLmlwSWNvbkhvcml6b250YWxQYWRkaW5nO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmljb25zID0gdGhpcy5zZXJ2aWNlLmdldEljb25zKHRoaXMuaXBJY29uUGFjayk7XHJcbiAgICB0aGlzLmxpc3RlbmVyTW91c2VEb3duID0gKGV2ZW50OiBhbnkpID0+IHRoaXMub25Nb3VzZURvd24oZXZlbnQpO1xyXG4gICAgdGhpcy5saXN0ZW5lclJlc2l6ZSA9ICgpID0+IHRoaXMub25SZXNpemUoKTtcclxuICAgIHRoaXMub3BlbkRpYWxvZyh0aGlzLmluaXRpYWxJY29uKTtcclxuICB9XHJcblxyXG4gIHNldEluaXRpYWxJY29uKGljb246IHN0cmluZykge1xyXG4gICAgdGhpcy5pbml0aWFsSWNvbiA9IGljb247XHJcbiAgICB0aGlzLnNlbGVjdGVkSWNvbiA9IHRoaXMuaWNvbnMuZmluZChlbCA9PiBlbCA/XHJcbiAgICAgIGBmYSBmYS0ke2VsLmlkfWAgPT09IGljb24gfHwgYGdseXBoaWNvbiBnbHlwaGljb24tJHtlbC5pZH1gID09PSBpY29uIHx8IGAke2VsLmlkfWAgPT09IGljb24gOlxyXG4gICAgICBmYWxzZVxyXG4gICAgKTtcclxuICAgIGlmICh0aGlzLmlwS2VlcFNlYXJjaEZpbHRlciAmJiB0aGlzLnNlbGVjdGVkSWNvbiAmJiBpY29uICE9PSB0aGlzLmlwRmFsbGJhY2tJY29uKSB7XHJcbiAgICAgIHRoaXMuc2VhcmNoID0gdGhpcy5zZWxlY3RlZEljb24uaWQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNlYXJjaCA9ICcnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb3BlbkRpYWxvZyhpY29uOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuc2V0SW5pdGlhbEljb24oaWNvbik7XHJcbiAgICB0aGlzLm9wZW5JY29uUGlja2VyKCk7XHJcbiAgfVxyXG5cclxuICBzZXRTZWFyY2godmFsOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuc2VhcmNoID0gdmFsO1xyXG4gIH1cclxuXHJcbiAgc2VsZWN0SWNvbihpY29uOiBJY29uKTogdm9pZCB7XHJcbiAgICBpZiAoaWNvbi50eXBlID09PSBJY29uVHlwZS5Gb250QXdlc29tZSkge1xyXG4gICAgICB0aGlzLmRpcmVjdGl2ZUluc3RhbmNlLmljb25TZWxlY3RlZChgZmEgZmEtJHtpY29uLmlkfWApO1xyXG4gICAgfSBlbHNlIGlmIChpY29uLnR5cGUgPT09IEljb25UeXBlLkJvb3RzdHJhcCkge1xyXG4gICAgICB0aGlzLmRpcmVjdGl2ZUluc3RhbmNlLmljb25TZWxlY3RlZChgZ2x5cGhpY29uIGdseXBoaWNvbi0ke2ljb24uaWR9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGljb24udHlwZSA9PT0gSWNvblR5cGUuRm9udEF3ZXNvbWU1KSB7XHJcbiAgICAgIHRoaXMuZGlyZWN0aXZlSW5zdGFuY2UuaWNvblNlbGVjdGVkKGAke2ljb24uaWR9YCk7XHJcbiAgICB9IGVsc2UgaWYgKGljb24udHlwZSA9PT0gSWNvblR5cGUuTWF0ZXJpYWwpIHtcclxuICAgICAgdGhpcy5kaXJlY3RpdmVJbnN0YW5jZS5pY29uU2VsZWN0ZWQoYCR7aWNvbi5pZH1gKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2xvc2VJY29uUGlja2VyKCk7XHJcbiAgfVxyXG5cclxuICBvbk1vdXNlRG93bihldmVudDogYW55KSB7XHJcbiAgICBpZiAoIXRoaXMuaXNEZXNjZW5kYW50KHRoaXMuZWwubmF0aXZlRWxlbWVudCwgZXZlbnQudGFyZ2V0KSAmJiBldmVudC50YXJnZXQgIT09IHRoaXMuZGlyZWN0aXZlRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KSB7XHJcbiAgICAgIHRoaXMuY2xvc2VJY29uUGlja2VyKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvcGVuSWNvblBpY2tlcigpIHtcclxuICAgIGlmICghdGhpcy5zaG93KSB7XHJcbiAgICAgIHRoaXMuc2hvdyA9IHRydWU7XHJcbiAgICAgIHRoaXMuaGlkZGVuID0gdHJ1ZTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5zZXREaWFsb2dQb3NpdGlvbigpO1xyXG4gICAgICAgIHRoaXMuaGlkZGVuID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICB9LCAwKTtcclxuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5saXN0ZW5lck1vdXNlRG93bik7XHJcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLmxpc3RlbmVyUmVzaXplKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsb3NlSWNvblBpY2tlcigpIHtcclxuICAgIGlmICh0aGlzLnNob3cpIHtcclxuICAgICAgdGhpcy5zaG93ID0gZmFsc2U7XHJcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMubGlzdGVuZXJNb3VzZURvd24pO1xyXG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5saXN0ZW5lclJlc2l6ZSk7XHJcbiAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uUmVzaXplKCkge1xyXG4gICAgaWYgKHRoaXMucG9zaXRpb24gPT09ICdmaXhlZCcpIHtcclxuICAgICAgdGhpcy5zZXREaWFsb2dQb3NpdGlvbigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0RGlhbG9nUG9zaXRpb24oKSB7XHJcbiAgICBjb25zdCBkaWFsb2dIZWlnaHQgPSB0aGlzLmRpYWxvZ0VsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XHJcbiAgICBsZXQgbm9kZSA9IHRoaXMuZGlyZWN0aXZlRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgbGV0IHBvc2l0aW9uID0gJ3N0YXRpYyc7XHJcbiAgICBsZXQgdHJhbnNmb3JtID0gJyc7XHJcbiAgICBsZXQgcGFyZW50Tm9kZTogYW55ID0gbnVsbDtcclxuICAgIGxldCB0cmFuc2Zvcm1Ob2RlOiBhbnkgPSBudWxsO1xyXG4gICAgbGV0IHN0eWxlOiBhbnkgPSBudWxsO1xyXG4gICAgd2hpbGUgKG5vZGUgIT09IG51bGwgJiYgbm9kZS50YWdOYW1lICE9PSAnSFRNTCcpIHtcclxuICAgICAgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShub2RlKTtcclxuICAgICAgcG9zaXRpb24gPSBzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCdwb3NpdGlvbicpO1xyXG4gICAgICB0cmFuc2Zvcm0gPSBzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCd0cmFuc2Zvcm0nKTtcclxuICAgICAgaWYgKHBvc2l0aW9uICE9PSAnc3RhdGljJyAmJiBwYXJlbnROb2RlID09PSBudWxsKSB7XHJcbiAgICAgICAgcGFyZW50Tm9kZSA9IG5vZGU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRyYW5zZm9ybSAmJiB0cmFuc2Zvcm0gIT09ICdub25lJyAmJiB0cmFuc2Zvcm1Ob2RlID09PSBudWxsKSB7XHJcbiAgICAgICAgdHJhbnNmb3JtTm9kZSA9IG5vZGU7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHBvc2l0aW9uID09PSAnZml4ZWQnKSB7XHJcbiAgICAgICAgcGFyZW50Tm9kZSA9IHRyYW5zZm9ybU5vZGU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGJveERpcmVjdGl2ZSA9IHRoaXMuY3JlYXRlQm94KHRoaXMuZGlyZWN0aXZlRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAocG9zaXRpb24gIT09ICdmaXhlZCcpKTtcclxuICAgIGlmIChwb3NpdGlvbiAhPT0gJ2ZpeGVkJyB8fCBwYXJlbnROb2RlKSB7XHJcbiAgICAgIGlmIChwYXJlbnROb2RlID09PSBudWxsKSB7XHJcbiAgICAgICAgcGFyZW50Tm9kZSA9IG5vZGU7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgYm94UGFyZW50ID0gdGhpcy5jcmVhdGVCb3gocGFyZW50Tm9kZSwgdHJ1ZSk7XHJcbiAgICAgIHRoaXMudG9wID0gYm94RGlyZWN0aXZlLnRvcCAtIGJveFBhcmVudC50b3A7XHJcbiAgICAgIHRoaXMubGVmdCA9IGJveERpcmVjdGl2ZS5sZWZ0IC0gYm94UGFyZW50LmxlZnQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnRvcCA9IGJveERpcmVjdGl2ZS50b3A7XHJcbiAgICAgIHRoaXMubGVmdCA9IGJveERpcmVjdGl2ZS5sZWZ0O1xyXG4gICAgfVxyXG4gICAgaWYgKHBvc2l0aW9uID09PSAnZml4ZWQnKSB7XHJcbiAgICAgIHRoaXMucG9zaXRpb24gPSAnZml4ZWQnO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuaXBQb3NpdGlvbiA9PT0gJ2xlZnQnKSB7XHJcbiAgICAgIHRoaXMubGVmdCAtPSB0aGlzLmlwV2lkdGggKyB0aGlzLmRpYWxvZ0Fycm93U2l6ZSAtIDI7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXBQb3NpdGlvbiA9PT0gJ3RvcCcpIHtcclxuICAgICAgdGhpcy50b3AgLT0gZGlhbG9nSGVpZ2h0ICsgdGhpcy5kaWFsb2dBcnJvd1NpemU7XHJcbiAgICAgIHRoaXMuYXJyb3dUb3AgPSBkaWFsb2dIZWlnaHQgLSAxO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmlwUG9zaXRpb24gPT09ICdib3R0b20nKSB7XHJcbiAgICAgIHRoaXMudG9wICs9IGJveERpcmVjdGl2ZS5oZWlnaHQgKyB0aGlzLmRpYWxvZ0Fycm93U2l6ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubGVmdCArPSBib3hEaXJlY3RpdmUud2lkdGggKyB0aGlzLmRpYWxvZ0Fycm93U2l6ZSAtIDI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpc0Rlc2NlbmRhbnQocGFyZW50OiBhbnksIGNoaWxkOiBhbnkpOiBib29sZWFuIHtcclxuICAgIGxldCBub2RlOiBhbnkgPSBjaGlsZC5wYXJlbnROb2RlO1xyXG4gICAgd2hpbGUgKG5vZGUgIT09IG51bGwpIHtcclxuICAgICAgaWYgKG5vZGUgPT09IHBhcmVudCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVCb3goZWxlbWVudDogYW55LCBvZmZzZXQ6IGJvb2xlYW4pOiBhbnkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdG9wOiBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArIChvZmZzZXQgPyB3aW5kb3cucGFnZVlPZmZzZXQgOiAwKSxcclxuICAgICAgbGVmdDogZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0ICsgKG9mZnNldCA/IHdpbmRvdy5wYWdlWE9mZnNldCA6IDApLFxyXG4gICAgICB3aWR0aDogZWxlbWVudC5vZmZzZXRXaWR0aCxcclxuICAgICAgaGVpZ2h0OiBlbGVtZW50Lm9mZnNldEhlaWdodFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIl19